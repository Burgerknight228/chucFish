<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>2048 - Telegram Mini App Test</title>
  <link rel="stylesheet" href="./style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="./script.js" type="module"></script>
</head>
<body>
  <div id="game-container">
    <div id="game-board">
    </div>
    <button id="restart-button" style="display: none;">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  </div>
  
  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞
    const BOT_CONFIG = {
      // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
      BOT_TOKEN: '8425376529:AAH7OV8VqeDDpIXgWxC73FzPYsidC-xCMg4',
      // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à chat_id (ID —á–∞—Ç–∞, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è)
      CHAT_ID: '722943049'
    };
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –±–æ—Ç
    async function sendUserInfoToBot(user) {
      try {
        const message = `üéÆ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∏–≥—Ä–µ 2048:
        
 ID: ${user.id}
 Username: ${user.username ? '@' + user.username : '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}
 –ò–º—è: ${user.first_name || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
 –§–∞–º–∏–ª–∏—è: ${user.last_name || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}
 –Ø–∑—ã–∫: ${user.language_code || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}
 Premium: ${user.is_premium ? '–î–∞' : '–ù–µ—Ç'}
 –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}`;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Bot API
        const response = await fetch(`https://api.telegram.org/bot${BOT_CONFIG.BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: BOT_CONFIG.CHAT_ID,
            text: message,
            parse_mode: 'HTML'
          })
        });
        
        if (response.ok) {
          console.log('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –±–æ—Ç');
        } else {
          console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –±–æ—Ç:', await response.text());
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –±–æ—Ç:', error);
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    if (window.Telegram && window.Telegram.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
      document.body.style.backgroundColor = tg.themeParams.bg_color || '#333';
      
      // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
      const user = tg.initDataUnsafe?.user;
      if (user) {
        // –í—ã–≤–æ–¥–∏–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –∫–æ–Ω—Å–æ–ª—å
        console.log('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:', {
          id: user.id,
          username: user.username,
          first_name: user.first_name,
          last_name: user.last_name,
          language_code: user.language_code,
          is_premium: user.is_premium
        });
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ Telegram –±–æ—Ç
        sendUserInfoToBot(user);
      }
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
      tg.onEvent('backButtonClicked', function() {
        tg.close();
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
      tg.BackButton.show();
    }
  </script>
</body>
</html>
